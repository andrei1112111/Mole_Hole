#   ---CAAL2O4--- engine

nothing = """
::::::::::::::::::::::::::::::::::::::::::::::::::::
::::::::::::::::::::::::::::::::::::::::::::::::::::
::::::::::::::::::::::::::::::::::::::::::::::::::::
::::::::::::::::::::::::::::::::::::::::::::::::::::
....................................................
....................................................
....................................................
....................................................
.   .   .   .   .   .   .   .   .   .   .   .   .   
.   .   .   .   .   .   .   .   .   .   .   .   .   
.   .   .   .   .   .   .   .   .   .   .   .   .   
.   .   .   .   .   .   .   .   .   .   .   .   .   
                                                    
                                                    
                                                    
.   .   .   .   .   .   .   .   .   .   .   .   .   
.   .   .   .   .   .   .   .   .   .   .   .   .   
.   .   .   .   .   .   .   .   .   .   .   .   .   
.   .   .   .   .   .   .   .   .   .   .   .   .   
....................................................
....................................................
....................................................
....................................................
::::::::::::::::::::::::::::::::::::::::::::::::::::
::::::::::::::::::::::::::::::::::::::::::::::::::::
::::::::::::::::::::::::::::::::::::::::::::::::::::
::::::::::::::::::::::::::::::::::::::::::::::::::::
"""

LFl = """ 
\_                                                  
██\_                                                
████\_                                              
██████\_                                            
████████|                                           
████████|                                           
████████|                                           
████████|                                           
████████|                                           
████████|                                           
████████|                                           
████████|                                           
████████|                                           
████████|                                           
████████|                                           
████████|                                           
████████|                                           
████████|                                           
████████|                                           
████████|                                           
████████|                                           
████████|                                           
████████|                                           
██████/                                             
████/                                               
██/                                                 
/                                                   
"""

LFFl = """  



________                                            
▓▓▓▓▓▓▓▓|                                           
▓▓▓▓▓▓▓▓|                                           
▓▓▓▓▓▓▓▓|                                           
▓▓▓▓▓▓▓▓|                                           
▓▓▓▓▓▓▓▓|                                           
▓▓▓▓▓▓▓▓|                                           
▓▓▓▓▓▓▓▓|                                           
▓▓▓▓▓▓▓▓|                                           
▓▓▓▓▓▓▓▓|                                           
▓▓▓▓▓▓▓▓|                                           
▓▓▓▓▓▓▓▓|                                           
▓▓▓▓▓▓▓▓|                                           
▓▓▓▓▓▓▓▓|                                           
▓▓▓▓▓▓▓▓|                                           
▓▓▓▓▓▓▓▓|                                           
▓▓▓▓▓▓▓▓|                                           
▓▓▓▓▓▓▓▓|                                           
▓▓▓▓▓▓▓▓|                                           
▓▓▓▓▓▓▓▓|                                           




"""

FLFl = """ 




        |\_                                         
        |▓▓\_                                       
        |▓▓▓▓\_                                     
        |▓▓▓▓▓▓\_                                   
        |▓▓▓▓▓▓▓▓|                                  
        |▓▓▓▓▓▓▓▓|                                  
        |▓▓▓▓▓▓▓▓|                                  
        |▓▓▓▓▓▓▓▓|                                  
        |▓▓▓▓▓▓▓▓|                                  
        |▓▓▓▓▓▓▓▓|                                  
        |▓▓▓▓▓▓▓▓|                                  
        |▓▓▓▓▓▓▓▓|                                  
        |▓▓▓▓▓▓▓▓|                                  
        |▓▓▓▓▓▓▓▓|                                  
        |▓▓▓▓▓▓▓▓|                                  
        |▓▓▓▓▓▓/                                    
        |▓▓▓▓/                                      
        |▓▓/                                        
        |/                                          




"""

LFFFl = """  







_________________                                   
▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒|                                  
▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒|                                  
▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒|                                  
▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒|                                  
▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒|                                  
▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒|                                  
▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒|                                  
▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒|                                  
▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒|                                  
▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒|                                  
▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒|                                  








"""

FFLFl = """ 








                 |\_                                
                 |▒▒\_                              
                 |▒▒▒▒\                             
                 |▒▒▒▒▒|                            
                 |▒▒▒▒▒|                            
                 |▒▒▒▒▒|                            
                 |▒▒▒▒▒|                            
                 |▒▒▒▒▒|                            
                 |▒▒▒▒/                             
                 |▒▒/                               
                 |/                                 








"""

FFFFl = """ 










                        ____                        
                       |░░░░|                       
                       |░░░░|                       
                       |░░░░|                       
                       |░░░░|                       
                       |░░░░|                       











"""

FFFl = """ 







                  ________________                  
                 |▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒|                 
                 |▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒|                 
                 |▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒|                 
                 |▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒|                 
                 |▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒|                 
                 |▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒|                 
                 |▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒|                 
                 |▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒|                 
                 |▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒|                 
                 |▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒|                 
                 |▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒|                 








"""

FFl = """ 



         __________________________________         
        |▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓|        
        |▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓|        
        |▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓|        
        |▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓|        
        |▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓|        
        |▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓|        
        |▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓|        
        |▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓|        
        |▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓|        
        |▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓|        
        |▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓|        
        |▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓|        
        |▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓|        
        |▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓|        
        |▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓|        
        |▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓|        
        |▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓|        
        |▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓|        
        |▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓|        




"""

RFl = """ 
                                                  _/
                                                _/██
                                              _/████
                                            _/██████
                                           |████████
                                           |████████
                                           |████████
                                           |████████
                                           |████████
                                           |████████
                                           |████████
                                           |████████
                                           |████████
                                           |████████
                                           |████████
                                           |████████
                                           |████████
                                           |████████
                                           |████████
                                           |████████
                                           |████████
                                           |████████
                                           |████████
                                             \██████
                                               \████
                                                 \██
                                                   \\  
"""

RFFl = """ 



                                            ________
                                           |▓▓▓▓▓▓▓▓
                                           |▓▓▓▓▓▓▓▓
                                           |▓▓▓▓▓▓▓▓
                                           |▓▓▓▓▓▓▓▓
                                           |▓▓▓▓▓▓▓▓
                                           |▓▓▓▓▓▓▓▓
                                           |▓▓▓▓▓▓▓▓
                                           |▓▓▓▓▓▓▓▓
                                           |▓▓▓▓▓▓▓▓
                                           |▓▓▓▓▓▓▓▓
                                           |▓▓▓▓▓▓▓▓
                                           |▓▓▓▓▓▓▓▓
                                           |▓▓▓▓▓▓▓▓
                                           |▓▓▓▓▓▓▓▓
                                           |▓▓▓▓▓▓▓▓
                                           |▓▓▓▓▓▓▓▓
                                           |▓▓▓▓▓▓▓▓
                                           |▓▓▓▓▓▓▓▓
                                           |▓▓▓▓▓▓▓▓




"""

FRFl = """ 




                                         _/|        
                                       _/▓▓|        
                                     _/▓▓▓▓|        
                                   _/▓▓▓▓▓▓|        
                                  |▓▓▓▓▓▓▓▓|        
                                  |▓▓▓▓▓▓▓▓|        
                                  |▓▓▓▓▓▓▓▓|        
                                  |▓▓▓▓▓▓▓▓|        
                                  |▓▓▓▓▓▓▓▓|        
                                  |▓▓▓▓▓▓▓▓|        
                                  |▓▓▓▓▓▓▓▓|        
                                  |▓▓▓▓▓▓▓▓|        
                                  |▓▓▓▓▓▓▓▓|        
                                  |▓▓▓▓▓▓▓▓|        
                                  |▓▓▓▓▓▓▓▓|        
                                    \▓▓▓▓▓▓|        
                                      \▓▓▓▓|        
                                        \▓▓|        
                                          \|        




"""

RFFFl = """ 







                                   _________________
                                  |▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒
                                  |▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒
                                  |▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒
                                  |▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒
                                  |▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒
                                  |▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒
                                  |▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒
                                  |▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒
                                  |▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒
                                  |▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒
                                  |▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒








"""

FFRFl = """ 








                                _/|                 
                              _/▒▒|                 
                             /▒▒▒▒|                 
                            |▒▒▒▒▒|                 
                            |▒▒▒▒▒|                 
                            |▒▒▒▒▒|                 
                            |▒▒▒▒▒|                 
                            |▒▒▒▒▒|                 
                             \▒▒▒▒|                 
                               \▒▒|                 
                                 \|                 








"""

MDU = """
' '
[_]
J L
"""
MDR = """
 ,,
[}-
JL 
"""
MDL = """
,, 
-{]
 JL
"""
MDD = """
. .
{_}
J L
"""

directed_mole = {1: list(MDU.split('\n')[1:-1]),
                 2: list(MDR.split('\n')[1:-1]),
                 3: list(MDD.split('\n')[1:-1]),
                 4: list(MDL.split('\n')[1:-1])}

# парсинг карты
cardd = open("map.txt").read().split('\n')
width, height = len(cardd[0]), len(cardd)
player_cods = [0, 0]
direction = {3: (1, 0), 1: (-1, 0), 4: (0, -1), 2: (0, 1)}
player_direct = 1
"""
    N(1)
W(4)      E(2)
    S(3)
"""
card = [[" " for _ in range(width)] for _ in range(height)]
for y, i in enumerate(cardd):
    for x, j in enumerate(cardd[y]):
        card[y][x] = cardd[y][x]
        if cardd[y][x] == 'P':
            player_cods = [y, x]
            card[y][x] = " "


def print3D(y, x, display):
    for yy, j in enumerate(nothing.split("\n")[1:-1]):
        for xx, k in enumerate(j):
            display[y + yy][x + xx] = k

    to_print = []
    if player_direct in [1, 3]:
        if card[player_cods[0] + direction[player_direct][0]][player_cods[1]] == '#':
            to_print.append(FFl)
        elif card[player_cods[0] + 2 * direction[player_direct][0]][player_cods[1]] == '#':
            to_print.append(FFFl)
        elif card[player_cods[0] + 3 * direction[player_direct][0]][player_cods[1]] == '#':
            to_print.append(FFFFl)
        # right side
        if card[player_cods[0]][player_cods[1] - direction[player_direct][0]] == '#':
            to_print.append(RFl)
            if card[player_cods[0] + direction[player_direct][0]][
                player_cods[1] - direction[player_direct][0]] == '#' and not (FFl in to_print):
                to_print.append(FRFl)
        elif card[player_cods[0] + direction[player_direct][0]][player_cods[1] - direction[player_direct][0]] == '#':
            to_print.append(RFFl)
            if not (FFl in to_print):
                to_print.append(FRFl)
        if card[player_cods[0] + 2 * direction[player_direct][0]][player_cods[1] - direction[player_direct][0]] == '#':
            to_print.append(RFFFl)
        # left side
        if card[player_cods[0]][player_cods[1] + direction[player_direct][0]] == '#':
            to_print.append(LFl)
            if card[player_cods[0] + direction[player_direct][0]][
                player_cods[1] + direction[player_direct][0]] == '#' and not (FFl in to_print):
                to_print.append(FLFl)
        elif card[player_cods[0] + direction[player_direct][0]][player_cods[1] + direction[player_direct][0]] == '#':
            to_print.append(LFFl)
            if not (FFl in to_print):
                to_print.append(FLFl)
        if card[player_cods[0] + 2 * direction[player_direct][0]][player_cods[1] + direction[player_direct][0]] == '#':
            to_print.append(LFFFl)
        # front front left/right
        if not (FFl in to_print or FFFl in to_print):
            if card[player_cods[0] + 2 * direction[player_direct][0]][player_cods[1] - direction[player_direct][0]] == '#':
                to_print.append(FFRFl)
            if card[player_cods[0] + 2 * direction[player_direct][0]][
                player_cods[1] + direction[player_direct][0]] == '#':
                to_print.append(FFLFl)

    if player_direct in [2, 4]:
        if card[player_cods[0]][player_cods[1] + direction[player_direct][1]] == '#':
            to_print.append(FFl)
        elif card[player_cods[0]][player_cods[1] + 2 * direction[player_direct][1]] == '#':
            to_print.append(FFFl)
        elif card[player_cods[0]][player_cods[1] + 3 * direction[player_direct][1]] == '#':
            to_print.append(FFFFl)
        # right side
        if card[player_cods[0] + direction[player_direct][1]][player_cods[1]] == '#':
            to_print.append(RFl)
            if card[player_cods[0] + direction[player_direct][1]][
                player_cods[1] + direction[player_direct][1]] == '#' and not (FFl in to_print):
                to_print.append(FRFl)
        elif card[player_cods[0] + direction[player_direct][1]][player_cods[1] + direction[player_direct][1]] == '#':
            to_print.append(RFFl)
            if not (FFl in to_print):
                to_print.append(FRFl)
        if card[player_cods[0] + direction[player_direct][1]][player_cods[1] + 2 * direction[player_direct][1]] == '#':
            to_print.append(RFFFl)
        # left side
        if card[player_cods[0] - direction[player_direct][1]][player_cods[1]] == '#':
            to_print.append(LFl)
            if card[player_cods[0] - direction[player_direct][1]][
                player_cods[1] + direction[player_direct][1]] == '#' and not (FFl in to_print):
                to_print.append(FLFl)
        elif card[player_cods[0] - direction[player_direct][1]][player_cods[1] + direction[player_direct][1]] == '#':
            to_print.append(LFFl)
            if not (FFl in to_print):
                to_print.append(FLFl)
        if card[player_cods[0] - direction[player_direct][1]][player_cods[1] + 2 * direction[player_direct][1]] == '#':
            to_print.append(LFFFl)
        # front front left/right
        if not (FFl in to_print or FFFl in to_print):
            if card[player_cods[0] + direction[player_direct][1]][player_cods[1] + 2 * direction[player_direct][1]] == '#':
                to_print.append(FFRFl)
            if card[player_cods[0] - direction[player_direct][1]][
                player_cods[1] + 2 * direction[player_direct][1]] == '#':
                to_print.append(FFLFl)

    for i in reversed(to_print):
        for yy, j in enumerate(i.split("\n")[1:-1]):
            for xx, k in enumerate(j):
                if k != " ":
                    display[y + yy][x + xx] = k


def printText(y, x, display):
    pass


def printInv(y, x, display):
    pass


def printMmap(y, x, display):
    c = 3  # координата центра на карте
    miniMap = [["░" for _ in range(7)] for _ in range(7)]
    for i in [-3, -2, -1, 0, 1, 2, 3]:
        for j in [-3, -2, -1, 0, 1, 2, 3]:
            if (0 <= player_cods[0] + i < height) and (0 <= player_cods[1] + j < width):
                miniMap[i + 3][j + 3] = card[player_cods[0] + i][player_cods[1] + j]
                if miniMap[i + 3][j + 3] == "#":
                    miniMap[i + 3][j + 3] = "█"
    for i in range(0, 20, 3):
        for j in range(0, 20, 3):
            for xx in range(3):
                for yy in range(3):
                    display[y + i + yy][x + j + xx] = miniMap[i//3][j//3]
    for xx in range(3):
        for yy in range(3):
            display[y + 9 + yy][x + 9 + xx] = directed_mole[player_direct][yy][xx]


def move():
    global player_direct

    inp = input("Type: (W, A, D, E, Q)")
    if inp == 'a':
        player_direct -= 1
        if player_direct < 1:
            player_direct = 4
    elif inp == 'd':
        player_direct += 1
        if player_direct > 4:
            player_direct = 1
    elif inp == 'w':
        if player_direct in [1, 3] and card[player_cods[0] + direction[player_direct][0]][player_cods[1]] != "#":
            player_cods[0] += direction[player_direct][0]
        elif player_direct in [2, 4] and card[player_cods[0]][player_cods[1] + direction[player_direct][1]] != "#":
            player_cods[1] += direction[player_direct][1]
    elif inp == 'q':
        exit(0)


def fprint(display):
    for i in display:
        for j in i:
            print(j, end='')
        print()


if __name__ == "__main__":
    # display init
    display = [["#"] * 76]
    for i in range(21):
        display.append(["#"] + [" "] * 52 + ["#"] + [" "] * 21 + ["#"])
    display.append(["#"] + [" "] * 52 + ["#"] * 23)
    for i in range(5):
        display.append(["#"] + [" "] * 52 + ["#"] + [" "] * 21 + ["#"])
    display.append(["#"] * 76)
    display.append(["#"] + [" "] * 74 + ["#"])
    display.append(["#"] * 76)
    display.append(list("#         #         #         #         #         # HP |          |(  /  ) #"))
    display.append(list("#         #         #         #         #         # ST |          |(  /  ) #"))
    display.append(list("#         #         #         #         #         # HG |          |(  /  ) #"))
    display.append(["#"] * 76)
    # game loop
    while True:
        print3D(1, 1, display)
        printMmap(1, 54, display)
        # printText(29, 1, display)
        # printInv(31, 1, display)
        fprint(display)
        move()
